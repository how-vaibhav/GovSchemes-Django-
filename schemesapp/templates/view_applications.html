{% extends "base.html" %} {% load static %} {% block content %}
<title>All Applications</title>
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link href="{% static 'css/view_applications.css' %}" rel="stylesheet" />

<h1 class="text-center text-light mb-5">Submitted Applications</h1>

<div class="tabs">
  <a
    href="?status=all"
    class="tab {% if current_filter == 'all' %}active{% endif %}"
  >
    All ({{ total_count }})
  </a>
  <a
    href="?status=pending"
    class="tab {% if current_filter == 'pending' %}active{% endif %}"
  >
    Pending ({{ pending_count }})
  </a>
  <a
    href="?status=accepted"
    class="tab {% if current_filter == 'accepted' %}active{% endif %}"
  >
    Accepted ({{ accepted_count }})
  </a>
  <a
    href="?status=rejected"
    class="tab {% if current_filter == 'rejected' %}active{% endif %}"
  >
    Rejected ({{ rejected_count }})
  </a>
</div>

<div class="container">
  {% if applications %} {% for app in applications %}
  <div class="application-card">
    <div class="application-header">Applicant: {{ app.user.username }}</div>
    <div class="application-detail">
      <strong>Aadhaar:</strong>
      {% if app.sensitive_data %} ********{{ app.sensitive_data|slice:"-4:" }}
      {% else %} Not Provided {% endif %}
    </div>
    <div class="application-detail">
      <strong>Scheme:</strong> {{ app.scheme.name }}
    </div>
    <div class="application-detail">
      <strong>Status:</strong> {{ app.status|capfirst }}
    </div>

    <div class="actions">
      {% if app.status == 'pending' %}
      <form
        method="post"
        action="{% url 'accept_application' app.id %}"
        style="display: inline"
      >
        {% csrf_token %}
        <button type="submit" class="btn-accept">Accept</button>
      </form>
      <form
        method="post"
        action="{% url 'reject_application' app.id %}"
        style="display: inline"
      >
        {% csrf_token %}
        <button type="submit" class="btn-reject">Reject</button>
      </form>
      {% else %}
      <em>No actions available</em>
      {% endif %}
    </div>
  </div>
  {% endfor %} {% else %}
  <p class="no-applications">No applications found.</p>
  {% endif %}
</div>
{% endblock %}
